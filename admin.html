<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Glove Admin Dashboard</title>
  
  <!-- Add SheetJS Library for Excel Export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

  <style>
    /* --- ADMIN DASHBOARD THEME --- */
    :root { --admin-bg: #f3f4f6; --admin-card: #ffffff; --admin-border: #e5e7eb; --admin-primary: #0a4f86; }
    body { background: var(--admin-bg); color: #1f2937; font-family: system-ui, -apple-system, sans-serif; margin: 0; }
    
    .admin-shell { max-width: 98%; margin: 0 auto; padding: 24px; }
    
    /* Login */
    .admin-login-card { max-width: 400px; margin: 80px auto; background: #fff; padding: 32px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }

    /* Header Bar */
    .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
    .admin-title { font-size: 24px; font-weight: 800; color: #111827; margin: 0; }
    .admin-controls { display: flex; gap: 12px; }

    /* Buttons */
    .btn { cursor: pointer; border: none; padding: 10px 16px; border-radius: 8px; font-weight: 600; font-size: 13px; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px; }
    .btn-primary { background: var(--admin-primary); color: #fff; }
    .btn-primary:hover { background: #083d6b; }
    .btn-white { background: #fff; border: 1px solid var(--admin-border); color: #374151; }
    .btn-white:hover { background: #f9fafb; border-color: #d1d5db; }
    .btn-success { background: #10b981; color: #fff; }
    .btn-success:hover { background: #059669; }
    .btn-danger { background: #fee2e2; color: #991b1b; }
    .btn-danger:hover { background: #fecaca; }

    /* Data Table */
    .table-card { background: #fff; border-radius: 12px; border: 1px solid var(--admin-border); overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column; }
    .toolbar { padding: 16px; border-bottom: 1px solid var(--admin-border); display: flex; gap: 16px; justify-content: space-between; background: #f9fafb; }
    .search-input { padding: 10px 12px; border: 1px solid var(--admin-border); border-radius: 8px; width: 300px; outline: none; }
    
    .data-table-wrap { max-height: calc(100vh - 240px); overflow: auto; }
    .data-table { width: 100%; border-collapse: collapse; font-size: 13px; text-align: left; }
    
    .data-table th { 
      background: #f9fafb; 
      position: sticky; 
      top: 0; 
      z-index: 10; 
      font-weight: 700; 
      color: #1f2937; 
      padding: 12px 12px; 
      border-bottom: 1px solid var(--admin-border); 
      white-space: nowrap; 
      font-size: 12px; 
      text-transform: uppercase; 
      letter-spacing: 0.05em; 
      user-select: none;
    }

    /* Draggable Header Styles */
    .data-table th.draggable {
      cursor: grab;
    }
    .data-table th.draggable:active {
      cursor: grabbing;
    }
    .data-table th.dragging {
      opacity: 0.5;
      background: #e5e7eb;
    }
    .data-table th.drag-over {
      border-left: 2px solid var(--admin-primary);
    }

    .data-table td { padding: 10px 12px; border-bottom: 1px solid var(--admin-border); color: #4b5563; vertical-align: middle; }
    
    /* Zebra Striping & Hover */
    .data-table tbody tr:nth-child(even) { background-color: #f9fafb; }
    .data-table tbody tr:hover { background-color: #eff6ff; }
    
    /* Interactive Rows */
    .data-table tbody tr { cursor: pointer; transition: background-color 0.1s; }

    /* Standard text cell with truncation */
    .cell-text {
      max-width: 180px; 
      white-space: nowrap; 
      overflow: hidden; 
      text-overflow: ellipsis; 
      display: block;
    }

    .cell-actions { display: flex; gap: 6px; justify-content: flex-end; }
    .col-actions { position: sticky; right: 0; background: #fff; border-left: 1px solid #f3f4f6; width: 100px; min-width: 100px; z-index: 11; }
    .data-table tr:hover .col-actions { background: #eff6ff; }
    .data-table th.col-actions { background: #f9fafb; cursor: default; }

    /* --- MODALS (POPUPS) --- */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 999; display: none; place-items: center; backdrop-filter: blur(2px); }
    .modal-overlay.open { display: grid; }
    
    .modal { background: #fff; width: 90vw; max-width: 900px; border-radius: 16px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; max-height: 90vh; animation: slideUp 0.2s ease-out; }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--admin-border); display: flex; justify-content: space-between; align-items: center; }
    .modal-title { font-size: 18px; font-weight: 700; margin: 0; }
    .modal-body { padding: 24px; overflow-y: auto; }
    .modal-footer { padding: 16px 24px; border-top: 1px solid var(--admin-border); background: #f9fafb; display: flex; justify-content: flex-end; gap: 12px; border-radius: 0 0 16px 16px; }

    /* Forms */
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
    .form-group label { display: block; font-size: 12px; font-weight: 600; color: #4b5563; margin-bottom: 6px; }
    .form-input { width: 100%; padding: 10px; border: 1px solid var(--admin-border); border-radius: 8px; font-size: 14px; outline: none; box-sizing: border-box; }
    .form-input:focus { border-color: var(--admin-primary); box-shadow: 0 0 0 3px rgba(10, 79, 134, 0.1); }

    /* Tabs inside Modal */
    .tabs { display: flex; gap: 4px; border-bottom: 1px solid var(--admin-border); margin-bottom: 20px; }
    .tab { padding: 10px 16px; cursor: pointer; font-size: 13px; font-weight: 600; color: #6b7280; border-bottom: 2px solid transparent; }
    .tab.active { color: var(--admin-primary); border-bottom-color: var(--admin-primary); }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Filter Checks */
    .filter-group-title { font-size: 14px; font-weight: 700; color: #111827; margin: 16px 0 10px; padding-bottom: 6px; border-bottom: 1px solid #f3f4f6; }
    .check-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
    .check-label { display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; user-select: none; }
    
    .hidden { display: none !important; }
    
    /* Badge only for Manager Modal */
    .badge { padding: 2px 8px; border-radius: 99px; font-size: 11px; font-weight: 600; background: #e5e7eb; color: #374151; border: 1px solid #d1d5db; }
  </style>
</head>
<body>

  <script src="data.js"></script>

  <!-- LOGIN VIEW -->
  <div id="loginView" class="admin-shell">
    <div class="admin-login-card">
      <h1 class="admin-title" style="margin-bottom:16px;">Admin Login</h1>
      <p style="color:#6b7280; font-size:13px; margin-bottom:20px;">Enter credentials to manage the Glove Selector.</p>
      <div class="form-group">
        <label>Username</label>
        <input class="form-input" id="user" autocomplete="username">
      </div>
      <div class="form-group" style="margin-top:12px;">
        <label>Password</label>
        <input class="form-input" id="pass" type="password" autocomplete="current-password">
      </div>
      <button class="btn btn-primary" style="width:100%; margin-top:24px; justify-content:center;" id="loginBtn">Login</button>
      <div id="loginMsg" style="color:red; font-size:12px; margin-top:12px; text-align:center;"></div>
    </div>
  </div>

  <!-- APP VIEW -->
  <div id="appView" class="admin-shell hidden">
    
    <!-- Header -->
    <div class="admin-header">
      <div>
        <h1 class="admin-title">Products</h1>
        <div style="font-size:12px; color:#6b7280; margin-top:4px;">
          Total products: <strong id="totalCount">0</strong> | Unsaved changes: <strong id="dirtyFlag" style="color:orange;">No</strong>
        </div>
      </div>
      <div class="admin-controls">
        <button class="btn btn-white" id="btnManageFilters">‚öôÔ∏è Manage Filters</button>
        <button class="btn btn-white" id="btnExport">üíæ Export data.js</button>
        <button class="btn btn-success" id="btnExportExcel">üìä Export Excel</button>
        <button class="btn btn-primary" id="btnNewProduct">+ New Product</button>
        <button class="btn btn-white" id="btnLogout" style="margin-left:12px;">Logout</button>
      </div>
    </div>

    <!-- Status Bar -->
    <div id="statusMsg" style="margin-bottom:16px; padding:10px; background:#e0f2fe; color:#0369a1; border-radius:8px; display:none;"></div>

    <!-- Main Data Table -->
    <div class="table-card">
      <div class="toolbar">
        <input type="text" id="searchBox" class="search-input" placeholder="Search code or name...">
      </div>
      <div class="data-table-wrap">
        <table class="data-table" id="dataTable">
          <thead>
            <tr id="tableHeaderRow">
              <!-- JS Injected -->
            </tr>
          </thead>
          <tbody id="productListBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- PRODUCT EDITOR MODAL -->
  <div id="productModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">Edit Product</h2>
        <button class="btn btn-white" style="padding:4px 8px;" id="modalClose">‚úï</button>
      </div>
      
      <div class="modal-body">
        <div class="tabs">
          <div class="tab active" data-tab="tab-core">Basic Info</div>
          <div class="tab" data-tab="tab-filters">Filters & Attributes</div>
        </div>

        <!-- Tab 1: Core Fields -->
        <div id="tab-core" class="tab-content active">
          <div class="form-grid">
            <div class="form-group">
              <label>Product Code *</label>
              <input class="form-input" id="f_code" placeholder="e.g. PRED13">
            </div>
            <div class="form-group">
              <label>Product Name</label>
              <input class="form-input" id="f_name" placeholder="e.g. Sapphire">
            </div>
            <div class="form-group">
              <label>Brand</label>
              <select class="form-input" id="f_brand"></select>
            </div>
            <div class="form-group">
              <label>Sizes (Display Text)</label>
              <input class="form-input" id="f_sizes" placeholder="e.g. 7 - 11">
            </div>
            <div class="form-group">
              <label>Image Path</label>
              <input class="form-input" id="f_image" placeholder="Images/CODE.jpg">
            </div>
            <div class="form-group">
              <label>Datasheet Path</label>
              <input class="form-input" id="f_datasheet" placeholder="Datasheets/CODE.pdf">
            </div>
          </div>
          <p style="font-size:12px; color:#6b7280; background:#f9fafb; padding:10px; border-radius:6px;">
            <strong>Note:</strong> Files are managed on your server/hosting. Just enter the relative path here.
          </p>
        </div>

        <!-- Tab 2: Filters -->
        <div id="tab-filters" class="tab-content">
          <div id="filtersContainer">
            <!-- Checkboxes injected by JS -->
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-danger" id="btnDeleteProduct" style="margin-right:auto;">Delete Product</button>
        <button class="btn btn-white" id="btnDuplicate">Duplicate</button>
        <button class="btn btn-primary" id="btnSaveModal">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- FILTERS MANAGER MODAL -->
  <div id="filterManagerModal" class="modal-overlay">
    <div class="modal" style="max-width: 600px; height: 80vh;">
      <div class="modal-header">
        <h2 class="modal-title">Manage Categories</h2>
        <button class="btn btn-white" style="padding:4px 8px;" id="filterManagerClose">‚úï</button>
      </div>
      <div class="modal-body">
        <p style="font-size:13px; color:#6b7280; margin-bottom:16px;">
          Add or remove categories and options. Deleting a category removes it from all products.
        </p>

        <!-- Add Category -->
        <div style="display:flex; gap:8px; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:16px;">
          <input id="newCatName" class="form-input" placeholder="New Category Name">
          <button id="btnAddCat" class="btn btn-primary">Add</button>
        </div>

        <!-- Category Accordion/List -->
        <div id="catManagerList"></div>

      </div>
    </div>
  </div>

  <script src="admin.js"></script>
</body>
</html>